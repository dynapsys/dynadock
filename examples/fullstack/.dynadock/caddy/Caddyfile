
# Dynamic Caddyfile generated by DynaDock – do not edit manually ⚠️

{
    email admin@local.dev
    
    auto_https off
    
}

# Health endpoint on port 80 (always plain HTTP)
:80 {
    respond /health "OK" 200
}




# ------------------------------
# Service: frontend    (8000)
# ------------------------------
frontend.local.dev {
    

    header {
        Access-Control-Allow-Origin "http://localhost:3000, http://localhost:5173, https://*.local.dev"
        Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS,PATCH"
        Access-Control-Allow-Headers "*"
        Access-Control-Allow-Credentials "true"
        Access-Control-Max-Age "3600"
    }

    @options method OPTIONS
    respond @options 204

    reverse_proxy frontend:8000 {
        health_uri /health
        health_interval 10s
        health_timeout 5s
    }

    log {
        output file /var/log/caddy/frontend.log
        format json
        level info
    }
}

# ------------------------------
# Service: backend    (8001)
# ------------------------------
backend.local.dev {
    

    header {
        Access-Control-Allow-Origin "http://localhost:3000, http://localhost:5173, https://*.local.dev"
        Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS,PATCH"
        Access-Control-Allow-Headers "*"
        Access-Control-Allow-Credentials "true"
        Access-Control-Max-Age "3600"
    }

    @options method OPTIONS
    respond @options 204

    reverse_proxy backend:8001 {
        health_uri /health
        health_interval 10s
        health_timeout 5s
    }

    log {
        output file /var/log/caddy/backend.log
        format json
        level info
    }
}

# ------------------------------
# Service: postgres    (8002)
# ------------------------------
postgres.local.dev {
    

    header {
        Access-Control-Allow-Origin "http://localhost:3000, http://localhost:5173, https://*.local.dev"
        Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS,PATCH"
        Access-Control-Allow-Headers "*"
        Access-Control-Allow-Credentials "true"
        Access-Control-Max-Age "3600"
    }

    @options method OPTIONS
    respond @options 204

    reverse_proxy postgres:8002 {
        health_uri /health
        health_interval 10s
        health_timeout 5s
    }

    log {
        output file /var/log/caddy/postgres.log
        format json
        level info
    }
}

# ------------------------------
# Service: redis    (8003)
# ------------------------------
redis.local.dev {
    

    header {
        Access-Control-Allow-Origin "http://localhost:3000, http://localhost:5173, https://*.local.dev"
        Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS,PATCH"
        Access-Control-Allow-Headers "*"
        Access-Control-Allow-Credentials "true"
        Access-Control-Max-Age "3600"
    }

    @options method OPTIONS
    respond @options 204

    reverse_proxy redis:8003 {
        health_uri /health
        health_interval 10s
        health_timeout 5s
    }

    log {
        output file /var/log/caddy/redis.log
        format json
        level info
    }
}

# ------------------------------
# Service: mailhog    (8004)
# ------------------------------
mailhog.local.dev {
    

    header {
        Access-Control-Allow-Origin "http://localhost:3000, http://localhost:5173, https://*.local.dev"
        Access-Control-Allow-Methods "GET,POST,PUT,DELETE,OPTIONS,PATCH"
        Access-Control-Allow-Headers "*"
        Access-Control-Allow-Credentials "true"
        Access-Control-Max-Age "3600"
    }

    @options method OPTIONS
    respond @options 204

    reverse_proxy mailhog:8004 {
        health_uri /health
        health_interval 10s
        health_timeout 5s
    }

    log {
        output file /var/log/caddy/mailhog.log
        format json
        level info
    }
}
